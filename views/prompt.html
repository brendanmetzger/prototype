<main>
  <script type="text/javascript">
    // <![CDATA[

      bloc.prepare('viewer', function () {  
        var clock = new SVG(document.body, {
          height: coords.h,
          width: coords.w,
          id: 'trace'
        });
        

        
        var defs = clock.createElement('defs');
        var gradient = clock.createElement('radialGradient', {
          id: 'gradientFlow'
        }, defs);

        var colors = ["#F8EBB7", "#F6F69C", "#EAF7B4", "#9CF69C", "#C3E9E1", "#9DBAE7", "#D9CDEC", "#F59898"];
        for (var i = 0; i < colors.length; i++) {
          clock.createElement('stop', {
            'offset': Math.round((i / colors.length) * 100) + '%',
            'stop-color': colors[i],
            'stop-opacity': 1
          }, gradient);
        }
      

        
        var grid = clock.createElement('g', {'class': 'grid'});
        var note = clock.createElement('g', {'class': 'annotation'});

        clock.createElement('line', {
          x1: 0,
          y1: coords.cy,
          x2: coords.w,
          y2: coords.cy
        }, grid);
        clock.createElement('line', {
          x1: coords.cx,
          y1: 0,
          x2: coords.cx,
          y2: coords.h
        }, grid);
  
        var line = clock.createElement('line', {
          x1: coords.cx,
          y1: coords.cy,
          x2: coords.cx,
          y2: coords.cy,
        });
        
        var amplitude = clock.createElement('circle', {
          cx: coords.cx,
          cy: coords.cy,
          r: 1
        }, grid);
  
        var boundary = clock.createElement('circle', {
          cx: coords.cx,
          cy: coords.cy,
          r: coords.cy,
          style: 'stroke-opacity:0.075;'
        });
        
  
        var angle_ref = clock.createElement('text', {
          x: coords.cx,
          y: coords.cy,
          dy: 5,
          dx: -10
        }, note);
  
        var radius_ref = clock.createElement('text', {
          x: coords.cx + 100,
          y: coords.cy + 100,
          dy: -10,
          dx: -10
        }, note);
  
        
  
        // document.body.style.height = window.innerHeight + 'px';
  
        boundary.addEventListener('mousemove', function (evt) {
          var radius    = Math.sqrt((evt.layerX - coords.cx).square() + (coords.cy - evt.layerY).square());
          var theta = Math.round(evt.theta());
          var color = colors[Math.floor(((theta > 0 ? theta : theta + 360) / 360) * colors.length)];
          var benchmark =  theta + (radius / (coords.cy * 10)).toFixed(3).substring(1);
    
          radius_ref.textContent = benchmark;
    
          line.set({
            x2: evt.layerX,
            y2: evt.layerY
          });
    
    
          amplitude.set({'r': radius, 'style': 'stroke:none;fill-opacity:0.1;fill:' + color});
    
    
          radius_ref.set({
            x: evt.layerX,
            y: evt.layerY
          });
    

        }, false);
      });
    // ]]>
  </script>
  
</main>