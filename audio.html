<!DOCTYPE html>
<html>
  <head>
    <title>Prototype</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta charset="utf-8" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1" />
    <meta name="apple-mobile-web-app-capable" content="no"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="A prototype"/>
    <script type="text/javascript">
      // <![CDATA[
      window.bloc = (function(d,w,c,q,t) {
        return { 
          tag: function (async) {var s = d.createElement('script');s.type='text/javascript';s.async=async;return s;},
          embed: function() {for (var i=0; i < arguments.length; i++) {var s = this.tag(false);s.src=s.src=arguments[i];s.onload = this.load; q.push(s);} return this;},
          track: function (src) { for (var i=0; i < arguments.length; i++) {t.push(this.tag(arguments[i], true));} return this;},
          load: function(){ if (q.length > 0) {d.body.appendChild(q.shift()); } else { for (var k in c) {w.bloc.execute(k, null)}; while(t.length > 0) d.body.appendChild(t.shift());}},
          execute: function(k, a) { if (c[k]) return c[k].call(this, a);},
          prepare: function(k, f) {if (typeof f === 'function') c[k] = f; else return c[k] || function() {};}
      };}(document, window, {}, [], []));
      
      bloc.embed('./setup.js');
      bloc.embed('./player.js');
      // ]]>
    </script>
    <link rel="stylesheet" type="text/css" href="screen.css" />
  </head>
  
  <body data-user="">
    <nav style="position:relative;z-index:100">
      <label>
        <strong>Speed</strong>
        <input type="range"  value="1.0" min="1.0" max="3" step="0.5" oninput="player.audio.playbackRate = this.value;" />
      </label>
      <label>
        <strong>Scrub</strong>
        <input type="range" value="1.0" min="0" max="100" step="1" oninput="player.seek(Number(this.value) / 100);" />
      </label>
    </nav>
    
    <script type="text/javascript">
      window.bloc.load();
      var player = null;
      var tracks = [
        'audio/Bucket_Boys.m4a',
        'audio/CPS_Excellence.m4a',
        'audio/Jordan.m4a',
        'audio/Poop.m4a',
        'audio/Riverview.m4a',
        'audio/Stargazing.m4a',
        'audio/White_Poverty.m4a',
        'audio/Skyline.m4a',
        'audio/Uptown.m4a',
        'audio/Swampland.m4a',
      ];
      

      bloc.prepare('player', function () {
        player = new Player(tracks);

        var ul = document.body.appendChild(document.createElement('ul'));
        ul.addEventListener('click', function (evt) {
          var idx = Number(evt.target.dataset.idx);
          player.play(idx);
        }, false);
        tracks.forEach(function (track, idx) {
          var li = ul.appendChild(document.createElement('li'));
          li.dataset.idx = idx;
          li.textContent = 'play ' + track;
        });
        
        
        document.body.addEventListener('dblclick', player.toggle.bind(player), false);
      });
    </script>
  </body>
</html>
